<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.slzhkj.smartworksite.model.mapper.ExternalUserMapper" >

    <sql id="Base_Column_List" >
      id, user_name, company, app_id, secret, create_time, update_time, remark
    </sql>

    <sql id="valid_Column_List" >
      id, user_name, app_id
    </sql>

    <select id="listExternalUser" parameterType="com.slzhkj.smartworksite.model.dto.SearchFormDto"
            resultType="com.slzhkj.smartworksite.model.entity.User">
        select
        <include refid="Base_Column_List" />
        from
        sws_external_user
        where
        is_del = 1
        <if test="userName != null and userName != ''" >
            and user_name = #{userName,jdbcType=VARCHAR}
        </if>
        <if test="company != null and company != ''">
            and company = #{company,jdbcType=VARCHAR}
        </if>
        <if test="appId != null and appId != ''" >
            and app_id = #{appId,jdbcType=VARCHAR}
        </if>
    </select>

    <select id="listExternalUserAll" resultType="com.slzhkj.smartworksite.model.entity.User">
        select
        <include refid="valid_Column_List" />
        from
        sws_external_user
    </select>

    <select id="listUsableExternalUserAll" resultType="com.slzhkj.smartworksite.model.entity.User">
        select
        <include refid="valid_Column_List" />
        from
        sws_external_user
        where is_del = 1
    </select>

    <insert id="insertExternalUser" parameterType="com.slzhkj.smartworksite.model.entity.User">
        insert into sws_external_user (
        user_name, company, app_id,
        secret, create_time, update_time,
        remark
        )
        values (
        #{userName,jdbcType=VARCHAR},#{company,jdbcType=VARCHAR},#{appId,jdbcType=VARCHAR},
        #{secret,jdbcType=VARCHAR},  NOW() , NOW(),
        #{remark,jdbcType=VARCHAR})
    </insert>

    <update id="updateExternalUser" parameterType="com.slzhkj.smartworksite.model.entity.User" >
        update sws_external_user
        <set >
            <if test="userName != null and userName != ''" >
                user_name = #{userName,jdbcType=VARCHAR},
            </if>
            <if test="company != null and company != ''">
                company = #{company,jdbcType=VARCHAR},
            </if>
            <if test="appId != null and appId != ''" >
                app_id = #{appId,jdbcType=VARCHAR},
            </if>
            <if test="secret != null and secret != ''" >
                secret = #{secret,jdbcType=VARCHAR},
            </if>

            <if test="remark != null and remark != ''" >
                remark =  #{remark,jdbcType=VARCHAR},
            </if>
            update_time = now()
        </set>
        where id = #{id,jdbcType=BIGINT}
        and is_del = 1
    </update>

    <update id="deleteExternalUser" parameterType="Integer">
        update sws_external_user
        set is_del = 0
        where id = #{id,jdbcType=BIGINT}
        and is_del = 1
    </update>

    <select id="getExternalUser" resultType="com.slzhkj.smartworksite.model.entity.User">
        select
        <include refid="Base_Column_List" />
        from
        sws_external_user
        where id = #{id,jdbcType=BIGINT}
        and is_del = 1
    </select>

</mapper>